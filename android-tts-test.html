<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Android TTS Test - Kolby's Pok√©dex</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            line-height: 1.6;
            max-width: 600px;
            margin: 0 auto;
        }
        .button {
            background: #007bff;
            color: white;
            border: none;
            padding: 15px 30px;
            margin: 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        .button:hover {
            background: #0056b3;
        }
        .button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            background: #f8f9fa;
            border-left: 4px solid #007bff;
        }
        .error {
            border-left-color: #dc3545;
            background: #f8d7da;
        }
        .success {
            border-left-color: #28a745;
            background: #d4edda;
        }
        .warning {
            border-left-color: #ffc107;
            background: #fff3cd;
        }
        .instructions {
            background: #e9ecef;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
        .voice-info {
            font-family: monospace;
            font-size: 12px;
            background: #f1f3f4;
            padding: 10px;
            border-radius: 3px;
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <h1>Android Text-to-Speech Test</h1>
    <p>This page helps diagnose TTS issues on Android devices for Kolby's Pok√©dex.</p>
    
    <div class="instructions">
        <h3>ü§ñ For Android Users:</h3>
        <p>If text-to-speech doesn't work, try these steps:</p>
        <ol>
            <li><strong>Enable Google TTS:</strong> Settings ‚Üí Accessibility ‚Üí Text-to-speech output ‚Üí Select Google Text-to-Speech</li>
            <li><strong>Install TTS Engine:</strong> Install "Google Text-to-Speech" from Play Store</li>
            <li><strong>Test TTS:</strong> Settings ‚Üí Accessibility ‚Üí Text-to-speech ‚Üí Listen to example</li>
            <li><strong>Alternative:</strong> Enable "TalkBack" or "Select to Speak" in Accessibility settings</li>
        </ol>
    </div>

    <div>
        <button class="button" onclick="checkTTSSupport()">üîç Check TTS Support</button>
        <button class="button" onclick="testSimpleTTS()">üó£Ô∏è Test Simple TTS</button>
        <button class="button" onclick="testPokemonTTS()">‚ö° Test Pok√©mon TTS</button>
        <button class="button" onclick="listVoices()">üìã List Available Voices</button>
        <button class="button" onclick="stopTTS()">üõë Stop TTS</button>
    </div>

    <div id="status"></div>
    <div id="voices"></div>

    <script>
        function log(message, type = 'status') {
            const statusDiv = document.getElementById('status');
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.innerHTML = `<strong>${new Date().toLocaleTimeString()}:</strong> ${message}`;
            statusDiv.appendChild(div);
            statusDiv.scrollTop = statusDiv.scrollHeight;
            console.log(`[TTS Test] ${message}`);
        }

        function checkTTSSupport() {
            log('üîç Checking Text-to-Speech support...');
            
            if (!('speechSynthesis' in window)) {
                log('‚ùå speechSynthesis not available in this browser', 'error');
                return false;
            }

            log('‚úÖ speechSynthesis is available');

            try {
                const testUtterance = new SpeechSynthesisUtterance('test');
                log('‚úÖ Can create SpeechSynthesisUtterance');
            } catch (error) {
                log(`‚ùå Cannot create SpeechSynthesisUtterance: ${error.message}`, 'error');
                return false;
            }

            const isAndroid = /Android/i.test(navigator.userAgent);
            if (isAndroid) {
                log('ü§ñ Android device detected');
                
                const voices = window.speechSynthesis.getVoices();
                log(`üìä Immediate voice count: ${voices.length}`);
                
                if (voices.length === 0) {
                    log('‚ö†Ô∏è No voices available immediately (common on Android)', 'warning');
                    
                    // Try to trigger voice loading
                    window.speechSynthesis.addEventListener('voiceschanged', function handler() {
                        const newVoices = window.speechSynthesis.getVoices();
                        log(`üìä Voices after voiceschanged event: ${newVoices.length}`);
                        window.speechSynthesis.removeEventListener('voiceschanged', handler);
                        
                        if (newVoices.length === 0) {
                            log('‚ùå Still no voices available. TTS may not be properly installed.', 'error');
                        } else {
                            log('‚úÖ Voices loaded successfully!', 'success');
                        }
                    });
                    
                    // Force voice loading
                    window.speechSynthesis.getVoices();
                } else {
                    log('‚úÖ Voices are available!', 'success');
                }
            } else {
                log('üíª Non-Android device detected');
            }

            return true;
        }

        function testSimpleTTS() {
            if (!checkTTSSupport()) return;
            
            log('üó£Ô∏è Testing simple TTS...');
            
            try {
                const utterance = new SpeechSynthesisUtterance('Hello, this is a test');
                utterance.rate = 0.8;
                utterance.pitch = 1.0;
                utterance.volume = 0.8;
                
                utterance.addEventListener('start', () => {
                    log('‚úÖ Simple TTS started successfully!', 'success');
                });
                
                utterance.addEventListener('end', () => {
                    log('‚úÖ Simple TTS completed successfully!', 'success');
                });
                
                utterance.addEventListener('error', (event) => {
                    log(`‚ùå Simple TTS failed: ${event.error} - ${event.message}`, 'error');
                });
                
                window.speechSynthesis.speak(utterance);
                log('üöÄ Simple TTS command sent...');
                
                // Check if it actually started
                setTimeout(() => {
                    if (!window.speechSynthesis.speaking && !window.speechSynthesis.pending) {
                        log('‚ö†Ô∏è TTS command sent but not speaking. May need manual activation.', 'warning');
                    }
                }, 500);
                
            } catch (error) {
                log(`‚ùå Error in simple TTS: ${error.message}`, 'error');
            }
        }

        function testPokemonTTS() {
            if (!checkTTSSupport()) return;
            
            log('‚ö° Testing Pok√©mon-style TTS...');
            
            try {
                const text = 'Pikachu. The Mouse Pok√©mon. It has small electric sacs on both its cheeks. If threatened, it looses electric charges from the sacs.';
                const utterance = new SpeechSynthesisUtterance(text);
                
                // Use similar settings to the Pok√©dex
                utterance.rate = 0.7;
                utterance.pitch = 1.0;
                utterance.volume = 1.0;
                
                // Try to use an English voice
                const voices = window.speechSynthesis.getVoices();
                const englishVoice = voices.find(voice => 
                    voice.lang.startsWith('en') && voice.localService === true
                ) || voices.find(voice => voice.lang.startsWith('en'));
                
                if (englishVoice) {
                    utterance.voice = englishVoice;
                    log(`üéØ Using voice: ${englishVoice.name} (${englishVoice.lang})`);
                }
                
                utterance.addEventListener('start', () => {
                    log('‚úÖ Pok√©mon TTS started successfully!', 'success');
                });
                
                utterance.addEventListener('end', () => {
                    log('‚úÖ Pok√©mon TTS completed successfully!', 'success');
                });
                
                utterance.addEventListener('error', (event) => {
                    log(`‚ùå Pok√©mon TTS failed: ${event.error} - ${event.message}`, 'error');
                });
                
                window.speechSynthesis.speak(utterance);
                log('üöÄ Pok√©mon TTS command sent...');
                
            } catch (error) {
                log(`‚ùå Error in Pok√©mon TTS: ${error.message}`, 'error');
            }
        }

        function listVoices() {
            log('üìã Listing available voices...');
            
            const voices = window.speechSynthesis.getVoices();
            const voicesDiv = document.getElementById('voices');
            
            if (voices.length === 0) {
                log('‚ùå No voices available', 'error');
                voicesDiv.innerHTML = '<div class="status error">No voices found</div>';
                return;
            }
            
            log(`üìä Found ${voices.length} voices`);
            
            let voicesHTML = '<h3>Available Voices:</h3>';
            voices.forEach((voice, index) => {
                const isEnglish = voice.lang.startsWith('en');
                const status = isEnglish ? 'success' : 'status';
                voicesHTML += `
                    <div class="voice-info">
                        <strong>${index + 1}. ${voice.name}</strong><br>
                        Language: ${voice.lang}<br>
                        Local Service: ${voice.localService}<br>
                        Default: ${voice.default}
                        ${isEnglish ? ' <span style="color: green;">‚úÖ ENGLISH</span>' : ''}
                    </div>
                `;
            });
            
            voicesDiv.innerHTML = voicesHTML;
        }

        function stopTTS() {
            log('üõë Stopping TTS...');
            window.speechSynthesis.cancel();
            log('‚úÖ TTS stopped');
        }

        // Initialize on page load
        window.addEventListener('load', () => {
            log('üöÄ TTS Test page loaded');
            
            // Android-specific initialization
            if (/Android/i.test(navigator.userAgent)) {
                log('ü§ñ Android detected - setting up enhanced initialization');
                
                // Listen for voiceschanged event
                window.speechSynthesis.addEventListener('voiceschanged', () => {
                    const voices = window.speechSynthesis.getVoices();
                    log(`üìä Voices updated: ${voices.length} voices available`);
                });
                
                // Trigger voice loading
                setTimeout(() => {
                    window.speechSynthesis.getVoices();
                }, 100);
            }
        });
    </script>
</body>
</html>
